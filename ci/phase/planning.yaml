- pwd
- 'export SRC_DIR=$PWD'

###################################################################################################
- clone:
  - 'echo "Cloning planning_ws"'
  - 'echo "src dir is:  $SRC_DIR" '
  - git submodule update planning/planning_workspace/
  - cd $SRC_DIR/planning/

  - rosintsall:
    - ln -s planning_workspace/rosinstall/deploy/deploy.rosinstall .rosinstall
    - cd deps/catkin
    - ln -s ../../planning_workspace/rosinstall/deploy/deploy-deps.rosinstall .rosinstall

  - wstool:
    - cd $SRC_DIR/planning/
    - deps:
      # update the workspace deps
      # phase tool, BUG FOUND!! : the full match does not pop off the rosinstall commands...
      # need to build each section as a seperate command!... need to get the order of the tree parsing correct
      - cd deps/catkin
      - wstool info
      - wstool update
      - install-deps:
        - cd $SRC_DIR/planning/
        - ./planning_workspace/install_dependencies.sh
    - repo:
      # update the workspace repo
      - cd $SRC_DIR/planning/
      - wstool info
      - wstool update

###################################################################################################
- build:
  # build the planning workspace (including any dependencies)
  - 'echo "Building planning_ws"'
  - 'echo "src dir is:  $SRC_DIR" '
  - cd planning/

  - deps:
    # build workspace deps
    - cd deps/catkin
    - catkin build --no-status
    - cd $SRC_DIR/../install/
    - wget https://s3.amazonaws.com/osrf-distributions/subt_robot_examples/releases/subt_robot_examples_latest.tgz
    - tar xf subt_robot_examples_latest.tgz -C deps --strip-components 1

  - ws:
    - cd $SRC_DIR/planning/
    # build workspace
    - catkin init
    - catkin build --no-status

###################################################################################################
- clean:
  - cd planning/
  - rm .rosinstall
  - rm deps/catkin/.rosinstall
