---
  # ////////////////////////////////////////////////////////////////////////
  # setup localhost
  # ////////////////////////////////////////////////////////////////////////
  - name: Docker Compose Setup
  
    # run playbook on the localhost
    hosts: localhost
    connection: local
    become_method: sudo
    become_user: root
  
    # ////////////////////////////////////////////////////////////////////////
    # setup variables to be shared in tasks
    # ////////////////////////////////////////////////////////////////////////
    vars_files:
      vars/packages.yaml
     
    # ////////////////////////////////////////////////////////////////////////
    # Tasks to execute
    # ////////////////////////////////////////////////////////////////////////
    tasks:
    
    # //////////////////////////////////////////////////////////////////////////
    # Docker Compose
    # //////////////////////////////////////////////////////////////////////////

    - name: Update get apt packages
      become: true
      apt:
        update_cache: yes
    
    - name: Get System Info, Kernel name
      shell: uname -s
      register: uname_kernel
  
    - name: Get System Info, Machine name
      shell: uname -m
      register: uname_machine
  
    - name: Download Docker Compose
      get_url:
        url: https://github.com/docker/compose/releases/download/1.24.1/docker-compose-{{ uname_kernel.stdout }}-{{ uname_machine.stdout }}
        dest: /usr/local/bin/docker-compose
        mode: a+x
  
    - name: Create Docker Compose Symbolic Link
      file:
        src: /usr/local/bin/docker-compose
        dest: /usr/bin/docker-compose
        state: link
    
    - name: Validate Docker Compose
      become: true
      shell: docker-compose --version
      register: docker_compose_version_out
  
    - name: Output Validate Docker Compose
      debug:
        msg: "Docker Compose Version: {{docker_compose_version_out.stdout}}"

    # //////////////////////////////////////////////////////////////////////////
    # Docker Machine
    # //////////////////////////////////////////////////////////////////////////
    
    - name: Download Docker Machine
      get_url:
        url: https://github.com/docker/machine/releases/download/v0.16.0-{{ uname_kernel.stdout }}-{{ uname_machine.stdout }}
        dest: /tmp/docker-machine
        mode: a+x
    
    - name: stat docker machine
      stat: path=/tmp/docker-machine
      register: docker_machine_stat
      
    - name: Move Docker Machine To Bin
      command: mv /tmp/docker-machine /usr/local/bin/
      when: docker_machine_stat.stat.exists
      become: true
