# //////////////////////////////////////////////////////////////////////////
- docker:
# //////////////////////////////////////////////////////////////////////////

  # ////////////////////////////////////////////////////////////////////////////
  - registry:
  # ////////////////////////////////////////////////////////////////////////////

    # //////////////////////////////////////////////////////////////////////////
    - azure:
    # //////////////////////////////////////////////////////////////////////////

      # pull images from the docker registry
      - pull:
        # change the docker context to the ugv azure docker daemon
        - docker context use $DOCKER_CONTEXT
        # pull the uav docker images from the laptop local registry
        - docker pull $AZURE_REGISTRY/subt-uav-gpu-ros
        - docker pull $AZURE_REGISTRY/subt-uav-gpu-uav
        - docker pull $AZURE_REGISTRY/subt-uav-cpu-ros
        - docker pull $AZURE_REGISTRY/subt-uav-cpu-uav
        # pull the perception docker images from the laptop local registry
        - docker pull $AZURE_REGISTRY/subt-perception-cpu-ros
        - docker pull $AZURE_REGISTRY/subt-perception-cpu-0.1

        # tag the uav docker images
        - docker tag $AZURE_REGISTRY/subt-uav-gpu-ros subt/uav-gpu:ros
        - docker tag $AZURE_REGISTRY/subt-uav-gpu-uav subt/uav-gpu:uav
        - docker tag $AZURE_REGISTRY/subt-uav-cpu-ros subt/uav-cpu:ros
        - docker tag $AZURE_REGISTRY/subt-uav-cpu-uav subt/uav-cpu:uav
        # tag the perception docker images
        - docker tag $AZURE_REGISTRY/subt-perception-cpu-ros subt/perception-cpu:ros
        - docker tag $AZURE_REGISTRY/subt-perception-cpu-0.1 subt/perception-cpu:0.1

        # remove the azure docker images
        - docker rmi $(docker images | grep $AZURE_REGISTRY | tr -s ' ' | cut -d ' ' -f 1)
        # show the docker images
        - docker images
        # change the docker context back to the default docker daemon
        - docker context use default

    # //////////////////////////////////////////////////////////////////////////
    - basestation:
    # //////////////////////////////////////////////////////////////////////////

      # pull images from the docker registry
      - pull:
        - docker context use default
        # tag the docker images on the basestation registry
        - docker tag subt/uav-gpu:ros $BASESTATION_REGISTRY/subt-uav-gpu-ros
        - docker tag subt/uav-gpu:uav $BASESTATION_REGISTRY/subt-uav-gpu-uav
        - docker tag subt/uav-cpu:ros $BASESTATION_REGISTRY/subt-uav-cpu-ros
        - docker tag subt/uav-cpu:uav $BASESTATION_REGISTRY/subt-uav-cpu-uav
        # tag the perception docker images
        - docker tag subt/perception-cpu:ros $BASESTATION_REGISTRY/subt-perception-cpu-ros
        - docker tag subt/perception-cpu:0.1 $BASESTATION_REGISTRY/subt-perception-cpu-0.1

          # push to local docker registry
        - docker push $BASESTATION_REGISTRY/subt-uav-gpu-ros
        - docker push $BASESTATION_REGISTRY/subt-uav-gpu-uav
        - docker push $BASESTATION_REGISTRY/subt-uav-cpu-ros
        - docker push $BASESTATION_REGISTRY/subt-uav-cpu-uav
        # tag the perception docker images
        - docker push $BASESTATION_REGISTRY/subt-perception-cpu-ros
        - docker push $BASESTATION_REGISTRY/subt-perception-cpu-0.1

        # change the docker context to the uav azure docker daemon
        - docker context use $DOCKER_CONTEXT
        # pull the uav docker images from the laptop local registry
        - docker pull $BASESTATION_REGISTRY/subt-uav-gpu-ros
        - docker pull $BASESTATION_REGISTRY/subt-uav-gpu-uav
        - docker pull $BASESTATION_REGISTRY/subt-uav-cpu-ros
        - docker pull $BASESTATION_REGISTRY/subt-uav-cpu-uav
        # pull the perception docker images from the laptop local registry
        - docker pull $BASESTATION_REGISTRY/subt-perception-cpu-ros
        - docker pull $BASESTATION_REGISTRY/subt-perception-cpu-0.1

        # tag the uav docker images
        - docker tag $BASESTATION_REGISTRY/subt-uav-gpu-ros subt/uav-gpu:ros
        - docker tag $BASESTATION_REGISTRY/subt-uav-gpu-uav subt/uav-gpu:uav
        - docker tag $BASESTATION_REGISTRY/subt-uav-cpu-ros subt/uav-cpu:ros
        - docker tag $BASESTATION_REGISTRY/subt-uav-cpu-uav subt/uav-cpu:uav
        # tag the perception docker images
        - docker tag $BASESTATION_REGISTRY/subt-perception-cpu-ros subt/perception-cpu:ros
        - docker tag $BASESTATION_REGISTRY/subt-perception-cpu-0.1 subt/perception-cpu:0.1

        # remove the basestation docker images
        - docker rmi $(docker images | grep $BASESTATION_REGISTRY | tr -s ' ' | cut -d ' ' -f 1)

        # show the docker images
        - docker images
        # change the docker context back to the default docker daemon
        - docker context use default

        # remove the basestation docker images
        - docker rmi $(docker images | grep $BASESTATION_REGISTRY | tr -s ' ' | cut -d ' ' -f 1)
